# MoodleRest

MoodleRest is a PHP class to query Moodle REST webservices.

## Quick start

Ensure you already have access to a Moodle webservice. To use this class you will need a token (generated by Moodle admin).

Include the MoodleRest.php class in your script.

```php
require_once('MoodleRest.php');
```

### Example 1

Set the server and token in constructor and make a request to create a group on Moodle.

```php
$MoodleRest = new MoodleRest('http://127.0.0.1/moodle/webservice/rest/server.php', '8f12e614dae30735260a045313caa400');

$new_group = array('groups' => array(array('courseid' => 2, 'name' => 'Group name', 'description' => 'Group description')));

$return = $MoodleRest->request('core_group_create_groups', $new_group);

// If you want the requested URL
echo $MoodleRest->getUrl();
```


### Example 2

Instantiate the MoodleRest object.

```php
$MoodleRest = new MoodleRest();
```

Set the Moodle server, token and the request return format (array, json or xml)

```php
$MoodleRest->setServerAddress("http://127.0.0.1/moodle/webservice/rest/server.php");
$MoodleRest->setToken('8f12e614dae30735260a045313caa400');
$MoodleRest->setReturnFormat(MoodleRest::RETURN_ARRAY); // Array is default. You can use RETURN_JSON or RETURN_XML too.
```

Call the server. In this example we query 2 pre-existent Moodle groups with IDs 1 and 2.

```php
$arr = $MoodleRest->request('core_group_get_groups', array('groupids' => array(1,2)));

print_r($arr);

// Note: You can make more requests using the same object
```


### Example 3

Make a request using chained methods and return the result as json.

```php
// This parameters translates in URL as: "userlist[0][userid]=5&userlist[1][userid]=4&userlist[0][courseid]=2&userlist[1][courseid]=2"
$parameters = array('userlist' => array(array('userid' => 5, 'courseid' => 2), array('userid' => 4, 'courseid' => 2)));

$json =
    (new MoodleRest())->setServerAddress("http://127.0.0.1/moodle/webservice/rest/server.php")->
    setToken('8f12e614dae30735260a045313caa400')->
    setReturnFormat(MoodleRest::RETURN_JSON)->request('core_user_get_course_user_profiles', $parameters);

echo $json;
```

More examples in [wiki](https://github.com/llagerlof/MoodleRest/wiki/MoodleRest-wiki).
